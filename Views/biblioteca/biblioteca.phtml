
<main id="main" class="main">

<div class="container mt-4">

    <!-- Buscador y filtro -->
    <div class="row mb-4">
        <div class="col-md-6">
            <input type="text" id="busqueda" class="form-control" placeholder="Buscar por título o autor">
        </div>
        <div class="col-md-4">
            <select id="categoria" class="form-select">
                <option value="">Todas las categorías</option>
                <option value="LES">LES</option>
                <option value="Cutáneo">Lupus Cutáneo</option>
                <option value="Investigación">Investigación</option>
                <option value="Manual clínico">Manual clínico</option>
            </select>
        </div>
        <div class="col-md-2">
            <button class="btn btn-primary w-100" id="filtrar">Filtrar</button>
        </div>
    </div>

    <!-- Cards -->
    <div class="row g-4" id="librosContainer">
        <?php foreach($this->libros as $libro): ?>
        <div class="col-md-4">
            <div class="card h-100">
                <img src="<?= PLANTILLA.'assets/img/'. $libro['portada'] ?>" class="card-img-top" alt="<?= $libro['titulo'] ?>">
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title"><?= $libro['titulo'] ?></h5>
                    <p class="card-text"><?= $libro['descripcion'] ?></p>
                    <p><small class="text-muted"><?= $libro['autor'] ?></small></p>
                   
                    <div class="mt-auto d-flex justify-content-between">
                        <button class="btn btn-secondary btn-sm" onclick="previsualizarLibro('<?=PLANTILLA.'assets/img/'. $libro['archivo'] ?>')">Previsualizar</button>
                        <a href="<?= PLANTILLA.'assets/img/'.$libro['archivo'] ?>" class="btn btn-primary btn-sm" download>Descargar</a>
                    </div>
                </div>
            </div>
        </div>
        <?php endforeach; ?>
    </div>

    <!-- Modal de previsualización -->
    <div class="modal fade" id="modalPrevisualizacion" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Previsualización del libro</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <iframe id="iframeLibro" src="" style="width:100%; height:600px;" frameborder="0"></iframe>
                </div>
            </div>
        </div>
    </div>
</div>
</main>
<script>
    function previsualizarLibro(rutaArchivo) {
    $('#iframeLibro').attr('src', rutaArchivo);
    $('#modalPrevisualizacion').modal('show');
}

// Filtrado con reload simple (o se puede hacer AJAX)
$('#filtrar').click(function() {
    let busqueda = $('#busqueda').val();
    let categoria = $('#categoria').val();
    let url = 'biblioteca?';

    if (busqueda) url += 'busqueda=' + encodeURIComponent(busqueda) + '&';
    if (categoria) url += 'categoria=' + encodeURIComponent(categoria);

    window.location.href = url;
});


</script>